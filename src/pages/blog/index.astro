---
import clsx from "clsx";
import { actions } from "astro:actions";
import H1 from "../../components/h1.astro";
import { formatDate } from "../../lib/utils";
import InfoLayout from "../../layouts/InfoLayout.astro";

const pageTitle = "Blog | Jasper Doan - Frontend Development Insights";
const pageDescription = "Read articles about frontend development, React, TypeScript, web development best practices, and software engineering tips from Jasper Doan.";

const categoriesResult = await Astro.callAction(actions.categories.getCategories, null);
const categories = categoriesResult?.data?.categories || [];

const selectedCategory = Astro.url.searchParams.get("category") || "all";

const articlesResult = await Astro.callAction(actions.categories.filterByCategory, {
    category: selectedCategory,
});

if (articlesResult?.error) {
    console.log("error", articlesResult.error);
}

const articles = articlesResult?.data?.articles || [];
---

<InfoLayout title={pageTitle} description={pageDescription} lang="vi">
    <div class="p-4 sm:pt-8 sm:px-12 pb-20 min-h-dvh">
        <H1> Blog </H1>
        <p class="mt-2 text-sm sm:text-base text-zinc-400">
            These articles are written in Vietnamese to support the local developer community.
        </p>

        <div class="mt-4 flex flex-wrap items-center gap-2">
            <span class="w-fit px-3 py-1 text-xs sm:text-sm rounded-full bg-zinc-100/20 text-white">
                Vietnamese
            </span>
            <span class="relative inline-flex w-fit">
                <span class="w-fit px-3 py-1 text-xs sm:text-sm rounded-full bg-zinc-100/5 text-zinc-500 cursor-not-allowed">
                    English
                </span>
                <span class="absolute top-0 right-0 -translate-y-1/2 translate-x-1/2 bg-zinc-200 text-zinc-900 text-xs font-medium rounded-full px-2 py-0.5 w-max">
                    Coming soon
                </span>
            </span>
        </div>

        <ul class="mt-4 flex items-center gap-4">
            <li>
                <a href="/blog" class={clsx("w-fit px-4 py-1 text-sm bg-transparent rounded-full transition-all duration-300 ease-in-out",
                    selectedCategory === "all" ? "text-white bg-zinc-100/20 outline-2 outline-offset-2 outline-zinc-100/20" : "text-zinc-400 hover:text-zinc-300"
                )}>
                    All
                </a>
            </li>

            {
                categories.map((category) => (
                    <li>
                        <a
                            href={`/blog?category=${category.toLowerCase()}`}
                            class={clsx("w-fit px-4 py-1 text-sm bg-transparent rounded-full transition-all duration-300 ease-in-out",
                                selectedCategory === category.toLowerCase() ? "text-white bg-zinc-100/20 outline-2 outline-offset-2 outline-zinc-100/20" : "text-zinc-400 hover:text-zinc-200"
                            )}
                        >
                            {category}
                        </a>
                    </li>
                ))
            }
        </ul>

        <ul class="mt-4 space-y-6">
            {
                articles.map((article) => (
                    <li>
                        <a
                            class="space-y-1 group"
                            href={`/blog/${article.data.slug}`}
                        >
                            <span class="inline-flex items-center w-fit px-2.5 py-0.5 text-xs rounded-full bg-zinc-100/10 text-zinc-300">
                                ðŸ‡»ðŸ‡³ Vietnamese
                            </span>
                            <h2 class="text-xl xl:text-2xl text-zinc-300 group-hover:text-white text-balance font-medium underline group-hover:underline-offset-2 decoration-transparent group-hover:decoration-zinc-500">
                                {article.data.title}
                            </h2>
                            <p class="text-base text-zinc-400">
                                {article.data.snippet}
                            </p>
                            <p class="text-sm text-zinc-500">
                                {formatDate(article.data.pubDate)} &middot;{" "}
                                {article.data.author}
                            </p>
                        </a>
                    </li>
                ))
            }
        </ul>
    </div>
</InfoLayout>
